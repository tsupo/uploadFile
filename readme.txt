uploadFile -- XML-RPC API を使ってココログにファイルをアップロードするプログラム
  作者: tsupo (H.Tsujimura,  mailto: tsupo@na.rim.or.jp)
  パッケージ作成日: 2009年3月31日
  パッケージ版数:   1.41

  背景:
    2004年12月に実施されたココログの仕様変更に伴い、ココログの管理画面からファイルをアップロードを
    行なう際、アップロード先のディレクトリが自由に選択できなくなってしまいました(画像ファイルは
    images、それ以外のファイルは files ディレクトリに各々自動的にアップロードされてしまいます)。
    調査の結果、XML-RPC API を使う限り、以前のようにディレクトリを選択してアップロードできることが
    わかったので、本ツールを作成し、ディレクトリを選択してアップロードしたい人に供することにしてみ
    ました。

    現在(2005年9月時点)では、ココログの管理画面から任意のディレクトリへファイルをアップロードできる
    ようになったため、本ツールを使う必要性はほとんどなくなった。しかし、管理画面経由でのアップロー
    ドでは、一部の拡張子のファイルのアップロードができないという制限は存在するため、本ツールの出番
    は全くなくなった訳ではありません(管理画面経由ではアップロードできないファイルでも、本ツールを使
    えばアップロードできる可能性があります。ただし、そのような拡張子のファイルは管理画面からは見る
    ことができないため、管理画面からは操作しようがという不都合があります。したがって、そのようなファ
    イルのアップロードは可能な限り差し控えることをお勧めします)。なお、そのようなファイルでも、本
    ツールのGUIバージョン(ここあっぷる)を使えば、削除することができます。

    1.20 版から、従来のココログ以外に、ココログフリーにも対応しています。

    なお、本ツールは私(tsupo)が個人的に提供するものであり、ニフティ株式会社およびココログ運営者と
    は一切関係ありません。本ツールに関して、ココログ事務局へ問い合わせることはご遠慮ください。


  このパッケージの説明:

    このパッケージには、以下のファイルが含まれています。

      readme.txt      いま、あなたが読んでいるファイル

      cocoUpple.exe   ココログにファイルをアップロードするプログラム GUI版
      uploadFile.exe  ココログにファイルをアップロードするプログラム コマンドライン版

      xmlRPC.dll      上記2つのプログラムを動かすのに必要なモジュール (サーバとの通信用)
      iconv.dll       同上 (文字コードの変換用) [このファイルの配布は GNU LGPL に従います]

      cocoUpple.exe.manifest
                      cocoUpple.exe を Windows XP 以降で動かす場合に参照するファイル
                      (ただし、Windows をクラシック設定にしている場合は、Windows XP 以降の
                       場合でも参照されません)

      iconv-1.9.1.win32 以下のファイル
        Windows 用 の GNU iconv ライブラリ のバイナリパッケージ
        (GNU LIBRARY GENERAL PUBLIC LICENSE に基づく配布です)

      src 以下のファイル
        uploadFile.exe および cocoUpple.exe.exe のソースファイル
        (xmlRPC.dll のソースファイルは今回の配布対象には入れていません)

  配布条件:
    iconv.dll および iconv-1.9.1.win32 以下のファイル は、GNU LIBRARY GENERAL PUBLIC LICENSE にしたがいます。
    それ以外のファイル(cocoUpple.exe, uploadFile.exe, xmlRPC.dll, および src 以下のファイル)は、tsupo の著作
    物です。配布は自由としますが、プログラムの動作および動作に伴い発生する諸々の事象に関しては無保証とします。

    書籍、雑誌等で本プログラムの紹介を行なったり、本パッケージを収録したりする場合は、事前に連絡してください。

    また、xmlRPC.h の内容を元に xmlRPC.dll の動作を推定し、xmlRPC.dll を利用するプログラムを第三者が作成する
    のは許可しますが、当該プログラムの配布は禁止します。(まだ、xmlRPC.h, atom.h, xmlRPC.dll は近い将来、当方
    で大幅に改編する可能性が高いため、いろんなバージョンが共存する状態をできるだけ避けたいのが理由の1つです)

  動作環境:
    Windows 95,98,98SE,ME (Windows 95A 以降、できれば Windows 95 OSR2.0 以降推奨)
    Windows NT4.0SP6a, 2000, XP
    Windows Server 2000, Windows 2003 Server
    (proxy 経由で使う場合は、IE4.0 以降がインストール済みであることを推奨)
   ※ パーソナルファイアウォールを使用している場合は、別途、ファイアウォールの調整が必要な場合があります

  インストール:
    本アーカイブに収録されている cocoUpple.exe, uploadFile.exe, xmlRPC.dll, iconv.dll を同一のディレクトリ
    (フォルダ)に解凍し、ご利用ください。特に、必要な作業はありません。

  アンインストール:
    cocoUpple.exe, uploadFile.exe, xmlRPC.dll, iconv.dll を削除するだけです。レジストリはいじっていません。

  使い方:
    cocoUpple.exe (GUI版)
      アイコンをマウスでダブルクリックすると起動します。
      各欄に必要な情報を入力、あるいは選択した後、「アップロード」ボタンを押すと、ファイルを指定したディレク
      トリにアップロードします。アップロードに成功すると、当該ファイルにアクセスするための URL を表示します
      ので、コピー&ペーストするなどして、ご利用ください。

      ユーザ名とパスワードを入力した後、blog 選択ボタンを押すと、当該ユーザ名にてファイルをアップロード可能
      なブログ(が1つしかない場合は、そのブログがアップロード対象ブログになります)を選択することができます。

      ファイルの削除を行なう場合は、URL をフルパス(http:// で始まるパス名)で指定してください。

      なお、cocoUpple.exe による各種設定内容は setting.inf という名前のファイルに保存されます。いったん設定
      を完全にクリアしたい場合は、setting.inf を削除した後、cocoUpple.exe を起動してください。

      アップロード先ディレクトリ名として ../ を指定することで、トップページ直下にファイルをアップロードする
      こともできます(ただし、トップディレクトリへのアップロードはファイルマネージャを利用するので、ファイル
      マネージャで使うことのできないファイル名、拡張子のファイルのアップロードはできません)。

    uploadFile.exe (コマンドライン版)
      コマンドプロンプト(DOSプロンプト、DOS窓)や、バッチファイル等で使うためのバージョンです。
      コマンドラインの書式は、以下の通り。

        uploadFile [-p] -uユーザ名 -Pパスワード [-bブログID] -fアップロードしたいファイルの名前 [-dアップロード先ディレクトリ名] -t[F]

          -p:         proxyサーバ経由でアップロードする場合に指定
          -bブログID: -uで指定したユーザ名で管理しているブログが複数存在する場合、どのブログにアップロード
                      するかをブログIDで指定 (管理しているブログが1つしかない場合は省略可能)
          -dアップロード先ディレクトリ名:
                      ファイルをアップロードするディレクトリ名を、ブログのトップページからの相対ディレクトリ
                      として指定する。ただし、ブログのトップページより上位の階層のディレクトリにはアップロー
                      ドできない。指定したディレクトリが存在しない場合は、新たにディレクトリを作成した上で
                      ファイルがアップロードされる。
                      なお、本引数を省略した場合は、ブログのトップディレクトリ直下にアップロードされる。
                      また、すでに同名のファイルが存在する場合は上書きされるのではなく、ファイル名の末尾に
                      適当な文字列(通常は数字)が付加されて、アップロードされる(これは、TypaPad系ブログの仕
                      様であり、また、ファイルを削除する API も存在しないため、本ツールではどうしようもない)
          -t または -tF:
                      従来のココログ(ココログベーシック、ココログプラス、ココログプロ)の場合は単に -t を指定
                      する。ココログフリーの場合は -tF を指定する。

  制限事項:
    ココログの管理画面からは最大40MBまでのサイズのファイルをアップロードすることができますが、本ツールは XML-RPC
    API 経由でのアップロードであるため、ファイルそのままではなく base64 エンコードしたものをアップロードするこ
    とになり、アップロード可能なファイルサイズの上限は 40MB より小さくなります(約30MB)。また、本ツールを動かすの
    に使っているPCの環境(メモリ容量、ファイアウォールやウィルスチェックソフトの影響)によっては、アップロード可能
    なファイルサイズの上限はさらに小さな値になることがあります。ご注意ください。

  バグ報告:
    このパッケージに含まれるプログラムの動作異常等、不具合を発見された方は、できるだけ詳細な報告を
      tsupo@na.rim.or.jp
    まで、電子メイルにて送付していただけると幸いです。

  サポート情報、1次配布元:
    本パッケージは、以下の URL にて配布しています。
        http://watcher.moe-nifty.com/memo/files/uploadFile133a.lzh
    以下の Webページに関連情報があります。
        http://watcher.moe-nifty.com/memo/2004/12/uploadfile.html
        http://watcher.moe-nifty.com/memo/2006/03/uploadfile.html

  関連情報:
    ココログでの「ファイルのアップロードに関する仕様変更」の波紋
      http://watcher.moe-nifty.com/memo/2004/12/post_4.html
    Movable Type で使える XML-RPC API
      http://www.na.rim.or.jp/~tsupo/program/blogTool/mt_xmlRpc.html

    ちなみに、本ツールは
      blogger.getUsersBlogs 
    により、指定ユーザIDで使用可能なブログ一覧を取得し、
      metaWeblog.newMediaObject
    を使い、ファイルのアップロードを行なっています。

    したがって、上記2つの API が使用可能なブログであれば、本プログラムを一部改造することにより、
    流用することが可能です。


  更新情報:
    Ver 1.41  2009年  3月31日  同梱の xmlRPC.dll に込みこんでいる OpenSSL を 0.9.8k 版に入れ替
                               えた
    Ver 1.40  2009年  3月23日  同梱の xmlRPC.dll に込みこんでいる OpenSSL を 0.9.8j 版に入れ替
                               えた
   (Ver 1.39) 2008年  2月27日 同梱している xmlRPC.dll を新しい版に入れ替えた
   (Ver 1.39) 2008年  2月12日 同梱している xmlRPC.dll を新しい版に入れ替えた
    Ver 1.39  2008年  2月 7日  「インターネット利用形態確認」ダイアログに対して no と答えても、
                              再度、「インターネット利用形態確認」ダイアログが表示されてしまう
                              現象に対処 (proxy の設定状況により、この現象が発生することがあっ
                              た)
    Ver 1.38  2007年 12月 6日 .. へのアップロードに関して、バイナリファイルのアップロードにも
                              対応した (今では XML-RPC API 経由でのアップロードの場合のみ、バ
                              イナリファイルのアップロードに対応していた)
    Ver 1.37  2007年 11月30日  (1) cocoUpple.exe.manifest を同梱するようにした
                               (2) xmlRPC.dll から不要になった処理を削除
                               (3) 「ここあっぷる」のメインダイアログにファイルをドロップ(する
                                   ことでファイル名を入力)できるようにした
    Ver 1.36  2007年 11月21日  同梱の xmlRPC.dll に込みこんでいる OpenSSL を 0.9.8g 版に入れ替
                               えた
    Ver 1.35  2007年 11月16日  基本的に Ver 1.34 とは同じもの(GUI版の方のソースコードをきれいに
                               して、ビルドし直しただけ。コマンドライン版の方はソースコードには
                               全く手を入れていない)。xmlRPC.dll は、2007年11月16日時点で最新の
                               ものを同梱した。
    Ver 1.34  2007年  9月28日  (1) 最小化ボタンを追加
                               (2) proxy 関連の設定情報におかしいところがあると判定された場合の
                                   再設定を促す機能を追加
                               (3) ココログの管理画面(コントロールパネルのファイル)で表示される
                                   ファイル数がある程度以上多いときに、ファイルの削除に失敗する
                                   (ファイルの削除に必要な情報の取得に失敗する)不具合に対処
    Ver 1.33a 2007年  1月 4日  (1) xmlRPC.dll 内に組み込んでいる OpenSSL の版を 0.9.8d に入れ替
                                   えた。
                               (2) バージョン情報表示ダイアログから、サポート用Webページに飛べる
                                   ようにした。
    Ver 1.33  2006年 12月12日  「ここあっぷる」立ち上げ後にいきなりファイルの削除を実行する場合、
                               proxyサーバ経由でのココログ管理画面へのログインに失敗する不具合に
                               対処した (proxy を使わない場合には、この不具合は発生しない)
    Ver 1.32  2006年 12月 4日  (1) .. へのアップロード時、ファイルの大きさが 65536 バイトより大
                                   きい場合、メモリオーバーランが発生する不具合を修正
                               (2) 大きなファイル(6MB以上)のファイルをアップロードする場合、アッ
                                   プロード途中でタイムアウトが発生して転送を中断してしまうこと
                                   がある現象に対処。ファイルサイズに合わせて、タイムアウトが発
                                   生するまでの時間を長くするようにした
    Ver 1.31  2006年 10月23日  base64エンコード後の大きさが 3MB を超える場合に、「ここあっぷる」
                               がクラッシュする不具合に対処 (「ここあっぷる」本体の改修ではなく、
                               同梱の xmlRPC.dll の方を改修することで対処した)
   (Ver 1.30) 2006年 10月10日  同梱の xmlRPC.dll を新しい版に入れ替えた(他の xmlRPC.dll 利用ツー
                               ルで発見された不具合を修正)のに伴い、リビルドし直した。ソースの
                               変更は行なっていない
    Ver 1.30  2006年  9月19日  (1) 「ここあっぷる」実行中に F1キーを押すと「ヘルプファイルが見
                                   つかりません」と表示されていたのを、表示されないように修正
                               (2) (xmlRPC.dll 内の)バッファオーバーランが発生する可能性のある箇
                                   所を修正
    Ver 1.21  2006年  3月15日  (1) ココログフリーの場合でもアップロード先に ../ を指定できるよう
                                   にした
                               (2) アップロード先としてトップディレクトリを指定する場合、../ で
                                   も .. でもどちらでもいいようにした
    Ver 1.20  2006年  3月14日  (1) ココログフリーにも対応した
                               (2) GUI版の方のみ、ファイル削除機能を追加した
                               (3) その他、使い勝手を少し変更した
    Ver 1.14  2005年 11月17日  メモリの許す限り、大きなファイルでも送信できるようにした。ただし、
                               ココログには1ファイル最大40MBまでという制限があるため、無制限に
                               大きなファイルをアップロードできるわけではないことに注意。
    Ver 1.13  2005年 11月15日  アップロードしようとしているファイルのサイズをチェックし、ファイ
                               ルサイズが大きすぎる場合はアップロードできないようにした。
   (Ver 1.12) 2005年  9月 5日  同梱のソースのうち xmlRPC.h が古いままだったので、新しいものに入
                               れ替えてパッケージを作り直し (xmlRPC.lib も入れ替え)
    Ver 1.12  2005年  9月 3日  同梱の xmlRPC.dll を新しい版に入れ替えたのに伴い、リビルドし直し
                               た。ソースの変更は行なっていない
   (Ver 1.11) 2005年  2月18日  同梱の xmlRPC.dll を新しい版に入れ替えたのに伴い、リビルドし直し
                               た。ソースの変更は行なっていない
    Ver 1.11  2005年  1月 7日  アップロード失敗時、ダイアログを出して、失敗したことを知らせるよ
                               うにした
    Ver 1.10  2005年  1月 4日  (1) error という文字列がファイル名に含まれるとアップロードに失敗
                                   したと誤判定してしまう不具合に対処
                               (2) 画像ファイルアップロード時に生成する html コードの width と 
                                   height の値がおかしかったのを修正
    Ver 1.00  2004年 12月28日  最初の版 「観測気球」にて公開

$Header: /comm/uploadFile/readme.txt 1     09/05/14 3:53 tsupo $
